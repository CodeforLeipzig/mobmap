<html>

<head>
  <title>Versammlungsgeschehen in Leipzig</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <style>
    body {
      padding: 0;
      margin: 0;
    }

    html,
    body,
    #map {
      height: 100%;
      width: 100vw;
    }

    .info {
      height: 80%;
      width: 400px;
      padding: 10px;
      background: white;
      border-radius: 4px;
      box-shadow: 0 1px 5px rgba(0, 0, 0, 0.5);
    }

    .leaflet-control-zoom {
      box-shadow: 0 1px 5px rgba(0, 0, 0, 0.5) !important;
      border: none !important;
    }
  </style>
</head>

<body>
  <div id="map" />

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <script>

    var rallys = [];

    var map = L.map('map', { zoomControl: false }).setView([51.3406321, 12.3747329], 12);

    L.control.zoom({
      position: 'bottomright'
    }).addTo(map);

    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png',
      {
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
      }
    ).addTo(map);

    rallys.forEach((rally) => {
      var demotrailsLayer = L.geoJSON(rally, {
        style: (feature) => {
          return {
            color: rally.features[0].properties.colorHex,
            weight: 5,
            opacity: 0.8
          };
        },
      });
      demotrailsLayer.addTo(map);

      demotrailsLayer.on('mouseover', function (e) {
        highlightFeature(e);
      });
      demotrailsLayer.on('mouseout', function (e) {
        resetHighlight(e);
      });
    });

    // control that shows state info on hover
    var info = L.control();

    info.onAdd = function (map) {
      this._div = L.DomUtil.create('div', 'info');
      this.update();
      return this._div;
    };

    info.update = function (props) {
      var htmlInner = '<div">';
      if (props) {
        if (props.locationName) {
          htmlInner += '<h4>' + props.locationName + '</h4>';
        }
        var fieldFun = (key) => {
          if (props[key]) {
            htmlInner += '<div><b>' + key + '</b>: ' + props[key] + '</div><br />';
          }
        }
        var fields = [
          "lfd. Nr", "Datum", "angezeigter Ort / Route", "angezeigte Zeit (von; bis)", "Veranstalter", "Art", "Thema/Motto", "Teilnehmer angezeigt", "Teilnehmer festgestellt", "Bemerkungen"
        ];
        fields.forEach(field => fieldFun(field));

      } else {
        htmlInner += '<p>Mit dem Mauszeiger Ã¼ber einen Marker/Strecke gehen, um Details anzuzeigen</p>'
      }
      htmlInner += '</div>';
      this._div.innerHTML = htmlInner;
    };

    info.addTo(map);

    function highlightFeature(e) {
      var layer = e.target;
      if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
        layer.bringToFront();
      }
      layer.setStyle({ weight: 7, opacity: 1.0 });

      info.update(e.layer.feature.properties);
    }

    function resetHighlight(e) {
      var layer = e.target;

      layer.setStyle({ weight: 5, opacity: 0.8 });

      info.update();
    }
  </script>
</body>

</html>
